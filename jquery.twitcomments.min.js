(function(c){var e={pushURL:null,pullURL:null,params:null,defaultProfileImageURL:null,cssClass:"twitcomments",comments:"Comments",twitterUsername:"Twitter Username",writeAComment:"Write a comment...",submit:"Comment",sending:"Sending...",errorNoName:"Please enter your Twitter name.",errorNoComment:"Please enter a comment.",errorCommentsNotLoaded:"The comments could no be loaded.",errorCommentNotSaved:"Your comment could not be saved.",from:"from",justNow:"just now",aMinuteAgo:"a minute ago",minutesAgo:"{} minutes ago",oneHourAgo:"one hour ago",hoursAgo:"{} hours ago",yesterday:"yesterday",daysAgo:"{} days ago",aWeekAgo:"a week ago",weeksAgo:"{} weeks ago",aMonthAgo:"a month ago",monthsAgo:"{} months ago",aYearAgo:"a year ago",yearsAgo:"{} years ago"};var d=null;var a=null;var b={init:function(f){c.extend(e,f);d=this;a=e.cssClass+"-";this.addClass(e.cssClass);this.hide();b._setupErrorDisplay.apply(this);b._setupCommentForm.apply(this);b._setupCommentList.apply(this);this.fadeIn();return this},_setupErrorDisplay:function(){errorDisplay=c('<span class="'+a+"span "+a+'error-message"></span>');errorDisplay.hide();this.append(errorDisplay)},_setupCommentForm:function(){action=(e.pushURL)?e.pushURL:"#";form=c('<form class="'+a+'form" action="'+action+'" method="post"></form>');fieldset=(c("<fieldset></fieldset>"));fieldset.append(c("<legend>"+e.comments+"</legend>"));usernameContainer=c('<div class="'+a+"container "+a+'username-container"></div>');usernameContainer.append(c('<label class="'+a+'at-prefix">@</label>'));usernameContainer.append(c('<input type="text" name="'+a+'screen_name" class="'+a+"input "+a+'input-screen_name" value="'+e.twitterUsername+'" />'));fieldset.append(usernameContainer);commentContainer=c('<div class="'+a+"container "+a+'comment-container"></div>');commentContainer.append(c('<textarea name="'+a+'comment" class="'+a+"textarea "+a+'input-comment">'+e.writeAComment+"</textarea>"));fieldset.append(commentContainer);submitContainer=c('<div class="'+a+"container "+a+'submit-container"></div>');submitContainer.append(c('<input type="submit" name="'+a+'submit" class="'+a+"button "+a+'input-submit" value="'+e.submit+'" />'));fieldset.append(submitContainer);form.append(fieldset);this.append(form);c("."+a+"form").on("submit.twitcomments",function(f){f.preventDefault();screenName=c("."+a+"input-screen_name").val();commentContent=c("."+a+"input-comment").val();if(screenName==""||screenName==e.twitterUsername){b._displayError(e.errorNoName);return false}else{if(commentContent==""||commentContent==e.writeAComment){b._displayError(e.errorNoComment);return false}else{b._pushComment()}}});c("."+a+"input-screen_name, ."+a+"input-comment").on("focus.twitcomments",function(){c(this).data("originalValue",c(this).val());c(this).val("")});c("."+a+"input-screen_name, ."+a+"input-comment").on("blur.twitcomments",function(){originalValue=c(this).data("originalValue");if(c(this).val()==""){c(this).val(originalValue)}})},_setupCommentList:function(){var f=c('<div class="'+a+'comments"></div>');this.append(f);c.ajax({url:e.pullURL,type:"GET",data:{params:e.params},dataType:"json",success:function(g){c.each(g,function(h,i){f.append(b._getCommentPostDOM(i))})},error:function(g,i,h){b._displayError(e.errorCommentsNotLoaded)}})},_pushComment:function(){b._toggleIndicator();c.ajax({url:e.pushURL,type:"POST",data:{user:c("."+a+"input-screen_name").val(),comment:c("."+a+"form ."+a+"input-comment").val(),params:e.params},dataType:"json",success:function(f){commentBlock=b._getCommentPostDOM(f).hide();c("."+a+"comments").prepend(commentBlock);commentBlock.fadeIn()},error:function(f,h,g){b._displayError(e.errorCommentNotSaved)},complete:function(){b._toggleIndicator()}})},_toggleIndicator:function(){submitButton=c("."+a+"input-submit");if(submitButton.attr("disabled")=="disabled"){submitButton.val(submitButton.data("original-text"));submitButton.removeAttr("disabled")}else{submitButton.data("original-text",submitButton.val());submitButton.val(e.sending);submitButton.attr("disabled","disabled")}},_getUserProfileDOM:function(f){imageURL=(!f.profile_image_url||f.profile_image_url=="")?e.defaultProfileImageURL:f.profile_image_url;fullName=(f.url)?'<a href="'+f.url+'">'+f.name+"</a>":f.name;userProfile=c('<div class="'+a+'comment"></div>');userProfile.append(c('<div class="'+a+'profile-image"><img src="'+imageURL+'" alt="" /></div>'));nameContainer=c('<div class="'+a+'name_container"></div>');if(f.name){nameContainer.append(c('<span class="'+a+"span "+a+'name">'+fullName+"</span>"))}nameContainer.append(c('<span class="'+a+"span "+a+'screen-name"><a href="http://twitter.com/'+f.screen_name+'">@'+f.screen_name+"</a></span>"));metaContainer=c('<div class="'+a+'meta_container"></div>');userProfile.append(nameContainer);if(f.location){metaContainer.append(c('<span class="'+a+"span "+a+'location">'+e.from+" "+f.location+"</span>"))}userProfile.append(metaContainer);return userProfile},_getCommentPostDOM:function(f){commentBlock=b._getUserProfileDOM(f);metaContainer=commentBlock.find("."+a+"meta_container");metaContainer.prepend(c('<span class="'+a+"span "+a+'time">'+b._relativeDate(new Date(f.comment_timestamp),new Date())+"</span>"));commentBlock.append(c('<div class="'+a+'content">'+f.comment_content+"</div>"));return commentBlock},_displayError:function(f){error=c('<span class="'+a+"span ."+a+'error">'+f+"</span>");c("."+a+"error-message").html(error).fadeIn()},_relativeDate:function(r,m){var g=1000,h=60*g,j=60*h,l=24*j,f=7*l,p=l*365,k=p/12;var q=[[0.7*h,e.justNow],[1.5*h,e.aMinuteAgo],[60*h,e.minutesAgo,h],[1.5*j,e.oneHourAgo],[l,e.hoursAgo,j],[2*l,e.yesterday],[7*l,e.daysAgo,l],[1.5*f,e.aWeekAgo],[k,e.weeksAgo,f],[1.5*k,e.aMonthAgo],[p,e.monthsAgo,k],[1.5*p,e.aYearAgo],[Number.MAX_VALUE,e.yearsAgo,p]];!m&&(m=(new Date).getTime());m instanceof Date&&(m=m.getTime());r instanceof Date&&(r=r.getTime());var t=m-r,s,n,o;for(n=-1,o=q.length;++n<o;){s=q[n];if(t<s[0]){return s[2]==undefined?s[1].replace("{}","1"):s[1].replace("{}",Math.round(t/s[2]))}}}};c.fn.twitComments=function(f){if(b[f]){return b[f].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof f==="object"||!f){return b.init.apply(this,arguments)}else{c.error("Method "+f+" does not exist on jQuery.twitComments")}}}})(jQuery);