(function(d){var f={auth:false,pushURL:null,pullURL:null,info:null,form:null,comments:null,intents:false,defaultProfileImage:null,strings:{twitterUsername:"Twitter Username",writeAComment:"Write a comment...",submit:"Comment",from:"from",justNow:"just now",aMinuteAgo:"a minute ago",minutesAgo:"minutes ago",oneHourAgo:"one hour ago",hoursAgo:"hours ago",yesterday:"yesterday",daysAgo:"days ago",aWeekAgo:"a week ago",weeksAgo:"weeks ago",aMonthAgo:"a month ago",monthsAgo:"months ago",aYearAgo:"a year ago",yearsAgo:"years ago"}};var b="twitcomments";var a=b+"-";var e;var c={init:function(g){e=this;d.extend(f,g);c._setupHTML.apply(this);c._setupEvents.apply(this);c._pullComments.apply(this);return this},_setupHTML:function(){this.addClass(b);if(null===f.form){action=(f.pushURL===null)?"#":f.pushURL;form=d('<form class="'+a+'form" action="'+action+'" method="post"></form>');form.append(d('<span class="'+a+"span "+a+'at-prefix">@</span>'));form.append(d('<input type="text" name="'+a+'screen_name" class="'+a+"input "+a+'input-name" value="'+f.strings.twitterUsername+'" />'));form.append(d('<textarea name="'+a+'comment" class="'+a+"textarea "+a+'input-comment">'+f.strings.writeAComment+"</textarea>"));form.append(d('<input type="submit" name="'+a+'submit" class="'+a+"button "+a+'input-submit" value="'+f.strings.submit+'" />'));this.append(form)}if(null===f.comments){comments=d('<div class="'+a+'comments"></div>');this.append(comments);comments.hide()}return this},_setupEvents:function(){d("."+a+"input-name, ."+a+"input-comment").on("focus.twitcomments",function(){d(this).data("originalValue",d(this).val());d(this).val("")});d("."+a+"input-name, ."+a+"input-comment").on("blur.twitcomments",function(){originalValue=d(this).data("originalValue");if(d(this).val()==""){d(this).val(originalValue)}});d("."+a+"input-name").on("blur.twitcomments",function(){c._updateUserInfo(d(this).val())});if(f.pushURL){d("."+a+"form").on("submit.twitcomments",function(g){c._submit();g.preventDefault()})}return this},_updateUserInfo:function(g){if(f.info==null&&d("."+a+"info").length==0){e.prepend(d('<div class="'+a+'info"></div>'))}infoBlock=(f.info)?f.info:d("."+a+"info");infoBlock.hide();d.ajax({url:"http://api.twitter.com/1/users/show.json",method:"GET",data:{screen_name:g},dataType:"jsonp",success:function(h){e.data("userExists",true);infoBlock.html(c._getNewUserBlock(h)).fadeIn()},error:function(h,j,i){}});return this},_pullComments:function(){if(f.pullURL){d.ajax({url:f.pullURL,method:"GET",dataType:"json",success:function(g){comments=d("."+a+"comments");d.each(g,function(h,i){comments.append(c._getNewUserBlock(i))});d("."+a+"comments").fadeIn()},status:{400:function(g,i,h){}}})}return this},_submit:function(){if(d("."+a+"form ."+a+"input-name").val()==""){alert("User empty")}else{if(!e.data("userExists")){alert("User no exist")}else{d.ajax({url:f.pushURL,method:"POST",data:{foo:"bar"},dataType:"json",success:function(g){infoBlock=c._getNewUserBlock(g).hide();d("."+a+"comments").prepend(infoBlock);infoBlock.fadeIn()},error:function(g,i,h){}})}}},_getNewUserBlock:function(g){imageURL=(g.profile_image_url)?g.profile_image_url:f.defaultProfileImage;fullName=(g.url)?'<a href="'+g.url+'">'+g.name+"</a>":g.name;twitterURL=(f.intents)?"https://twitter.com/intent/user?screen_name="+g.screen_name:"http://twitter.com/"+g.screen_name;block=d("<div></div>");block.append(d('<img src="'+imageURL+'" alt="" class="'+a+'user-image" />'));if(g.name){block.append(d('<span class="'+a+"span "+a+'user-fullname">'+fullName+"</span>"))}block.append(d('<span class="'+a+"span "+a+'user-twittername"><a href="'+twitterURL+'">@'+g.screen_name+"</a></span>"));if(g.comment_timestamp){block.append(d('<span class="'+a+"span "+a+'comment-time">'+c._relativeDate(new Date(g.comment_timestamp),new Date())+"</span>"))}if(g.location){block.append(d('<span class="'+a+"span "+a+'user-location">'+f.strings.from+" "+g.location+"</span>"))}if(g.comment_content){block.append(d('<span class="'+a+"span "+a+'comment-content">'+g.comment_content+"</span>"))}return block},_relativeDate:function(s,n){var h=1000,j=60*h,k=60*j,m=24*k,g=7*m,q=m*365,l=q/12;var r=[[0.7*j,f.strings.justNow],[1.5*j,f.strings.aMinuteAgo],[60*j,f.strings.minutesAgo,j],[1.5*k,f.strings.oneHourAgo],[m,f.strings.hoursAgo,k],[2*m,f.strings.yesterday],[7*m,f.strings.daysAgo,m],[1.5*g,f.strings.aWeekAgo],[l,f.strings.weeksAgo,g],[1.5*l,f.strings.aMonthAgo],[q,f.strings.monthsAgo,l],[1.5*q,f.strings.aYearAgo],[Number.MAX_VALUE,f.strings.yearsAgo,q]];!n&&(n=(new Date).getTime());n instanceof Date&&(n=n.getTime());s instanceof Date&&(s=s.getTime());var u=n-s,t,o,p;for(o=-1,p=r.length;++o<p;){t=r[o];if(u<t[0]){return t[2]==undefined?t[1]:Math.round(u/t[2])+" "+t[1]}}}};d.fn.twitComments=function(g){if(c[g]){return c[g].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof g==="object"||!g){return c.init.apply(this,arguments)}else{d.error("Method "+g+" does not exist on jQuery.twitComments")}}}})(jQuery);